#burpsuite


## 1.1. Inspección del tráfico web

Al analizar una aplicación web desconocida, siempre debemos comenzar con una inspección del tráfico. Una aplicación web presenta diversos elementos de interfaz y realiza varias transacciones de red.

Como investigadores, siempre nos interesa obtener la mayor cantidad de información posible sobre nuestros objetivos y, en este caso, un proxy de aplicación web es una herramienta indispensable. Podemos usar un buen proxy para capturar las solicitudes relevantes del cliente y las respuestas del servidor, y manipular fácilmente una solicitud específica de forma arbitraria.

En este curso, utilizaremos principalmente la edición comunitaria de Burp Suite (instalada por defecto en Kali Linux), que nos proporciona todo lo necesario para llevar a cabo una recopilación exhaustiva de información y la manipulación de solicitudes HTTP.

## 1.1.1. Proxy de Burp Suite

Podemos iniciar Burp Suite en Kali a través del menú de inicio. Una vez que lo iniciemos, es posible que recibamos una notificación que indique que Burp Suite no se ha probado con nuestra versión actual de Java (Figura 1).

![[Pasted image 20251114012639.png]]

Dado que el equipo de Kali siempre prueba Burp Suite en la versión de Java que viene con el sistema operativo, podemos ignorar esta advertencia sin problemas.
La primera vez que ejecutemos Burp Suite, nos pedirá que aceptemos los Términos y Condiciones.

![[Pasted image 20251114012706.png]]

Podemos aceptar los Términos y Condiciones haciendo clic en _Acepto_ después de decidir si deseamos enviar comentarios anónimos o no.

La siguiente ventana nos ofrece la posibilidad de iniciar un nuevo proyecto o restaurar uno guardado previamente. La capacidad de usar archivos de proyecto es una función de Burp Suite Professional. No necesitamos usar esta función para este curso, así que dejaremos seleccionada la opción _«Proyecto temporal»_ y continuaremos.

![[Pasted image 20251114012736.png]]

La última ventana ofrece la opción de cargar una configuración personalizada o aceptar la predeterminada. Burp Suite nos permite personalizar y optimizar nuestro flujo de trabajo y configuración mediante estas opciones. Por ahora, utilizaremos el perfil predeterminado de Burp Suite y haremos clic en Iniciar Burp .

![[Pasted image 20251114012825.png]]


Una vez iniciado Burp Suite, podemos comprobar que nuestro servicio proxy está funcionando consultando el registro de eventos en la esquina inferior izquierda del panel de control. Se mostrará un mensaje similar al siguiente:

![[Pasted image 20251114012841.png]]


Ahora que el servicio proxy está en funcionamiento, necesitamos configurar un navegador. Burp Suite incluye un navegador Chromium integrado que viene preconfigurado para redirigir el tráfico a través del proxy de Burp Suite. Podemos abrirlo haciendo clic en la pestaña «Proxy» y luego en la pestaña «Interceptar».

![[Pasted image 20251114012911.png]]

Podemos abrir el navegador Chromium integrado haciendo clic en cualquiera de los botones _"Abrir navegador"_ de esta pestaña.

Ahora que nuestro proxy está configurado, lo probaremos brevemente. En este caso, accederemos a la máquina virtual del laboratorio que aloja una versión vulnerable de la aplicación web [_Concord_](https://concord.walmartlabs.com/)
 .
Tenga en cuenta que, para este curso, hemos creado entradas en el archivo hosts de nuestra máquina de ataque Kali Linux que nos permiten referirnos a las máquinas del laboratorio por su nombre.
  
 ```bash
kali@kali:~$ cat /etc/hosts
127.0.0.1	localhost
127.0.1.1	kali

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
# AWAE lab machines
192.168.121.103 atutor
192.168.121.112 bassmaster
192.168.121.113 manageengine
192.168.121.120 dnn
192.168.121.123 erpnext
192.168.121.126 opencrx
192.168.121.129 openitcockpit
192.168.121.132 concord
192.168.121.135 apigateway
192.168.121.138 chips
192.168.121.247 photog
192.168.121.247 sqeakr
192.168.121.249 docedit
192.168.121.251 answers
192.168.121.253 debugger 
```

![[Pasted image 20251114013151.png]]

```
student : studentlab
```

![[Pasted image 20251114013223.png]]

Si ahora intentamos acceder a la URL **http://concord:8001/** , observaremos que el navegador no completa la solicitud ya que Burp Suite activa la función _Intercept_ de forma predeterminada.
![[Pasted image 20251114013319.png]]
Como su nombre indica, esta función intercepta las solicitudes enviadas al proxy. A continuación, permite inspeccionar y reenviar una solicitud al destino o descartarla mediante los botones correspondientes, como se muestra en la figura 8.

![[Pasted image 20251114013332.png]]

Para los fines de este módulo, podemos desactivar esta función de forma segura haciendo clic en _"Interceptar está activado_ ". El texto del botón se actualizará a "Interceptar está desactivado".

La pestaña _de historial HTTP_ es bastante autoexplicativa: aquí es donde Burp Suite muestra todo el historial de la sesión, que incluye todas las solicitudes y respuestas enviadas a través de él.

![[Pasted image 20251114013352.png]]

Excelente. Hemos verificado que Burp Suite está capturando nuestro tráfico de navegación.

## 1.1.2. Uso de Burp Suite con otros navegadores

Antes de continuar con otras herramientas de Burp Suite, veamos cómo configurar otro navegador para usar Burp Suite como proxy. En Firefox, podemos hacerlo accediendo a **about:preferences#advanced** , desplazándonos hacia abajo hasta Configuración de red y haciendo clic en _Configuración_ .

Aquí seleccionaremos la opción _Manual_ , configurando la dirección IP y el puerto de escucha adecuados. En nuestro caso, el proxy y el navegador se encuentran en el mismo servidor, por lo que utilizaremos la interfaz de bucle invertido y especificaremos el puerto 8080. Sin embargo, si planeáramos usar el proxy para interceptar el tráfico de varias máquinas, usaríamos la dirección IP pública de la máquina que ejecuta el proxy para esta configuración.

Finalmente, también queremos marcar la opción _"Usar este servidor proxy para todos los protocolos"_ para asegurarnos de que podemos interceptar todas las solicitudes mientras probamos la aplicación objetivo.

![Figura 10: Configuración de red de Firefox](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/5be21d2df4c43d524be69ba0a65f8836-tm_firefox_cfg_01.png)

Figura 10: Configuración de red de Firefox

Tenga en cuenta que, una vez configurado Firefox de esta manera, necesitaremos tener Burp Suite en ejecución para acceder a cualquier sitio web. Para dejar de usar Burp Suite como proxy, debemos volver a la configuración de conexión y seleccionar « _Usar la configuración de proxy del sistema_». Como alternativa, podemos usar alguna extensión del navegador (como FoxyProxy) para cambiar entre las configuraciones del servidor proxy.

## 1.1.3. Scope de Burp Suite


Burp Suite nos permite establecer un ámbito de recopilación. Ahora podemos hacerlo haciendo clic con el botón derecho en cualquier solicitud de Concord (con una URL que termine con una barra diagonal) y seleccionando « _Add to Scope»_ .

Tenga en cuenta que realizar esta acción en una solicitud de URL de dominio de nivel superior agregará todo el dominio al ámbito. En cambio, realizar esta acción en una página más específica de una aplicación web determinada solo agregará esa página al ámbito.

![[Pasted image 20251114002613.png]]

Una vez que establecemos el ámbito, se nos da la opción de dejar de capturar elementos que no están dentro del ámbito. Elegiremos _Sí_.

![[Pasted image 20251114002914.png]]

Ahora que hemos añadido el servidor Concord a nuestro scope, podemos cambiar la configuración del filtro _del historial HTTP_ para que muestre solo los elementos que lo componen. Para ello, haremos clic en el cuadro de filtro, seleccionaremos « _Mostrar solo los elementos del ámbito»_ y haremos clic fuera del cuadro de filtro.

![[Pasted image 20251114002956.png]]

Una vez actualizado el filtro, la solicitud a **[content-autofill.googleapis.com](http://content-autofill.googleapis.com)** queda oculta, como se muestra en la Figura 14. Configurar el alcance en Burp Suite puede eliminar el "ruido" causado por los navegadores que intentan actualizarse o descargar otros recursos.

![[Pasted image 20251114003021.png]]

Podemos verificar que nuestro ámbito se ha configurado correctamente cambiando a la pestaña _Objetivo_ y luego seleccionando la subpestaña _Ámbito_.

![[Pasted image 20251114003040.png]]

El ámbito de destino muestra la URL base del servidor Concord con una marca de verificación que indica que está habilitado.

## 1.1.4. Repetidor y comparador Burp Suite

Al inspeccionar aplicaciones web, a menudo necesitamos determinar cómo los cambios granulares en nuestras solicitudes HTTP afectan la respuesta que devuelve un servidor web. En esos casos, podemos usar la herramienta Burp Suite _Repeater_ para realizar cambios arbitrarios y muy precisos en una solicitud capturada y luego reenviarla al servidor web de destino.

Vamos a probarlo. Volvamos a la pestaña _Proxy_ > _Historial HTTP_ y usemos la solicitud a **/api/service/console/whoami** . Hagamos clic con el botón derecho y seleccionemos _Enviar al repetidor_ (Figura 16).

![Figura 16: Burp Suite: Enviar a repetidor](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/496c96afcba9860f99c1be8ff3c2de6d-tm_burp_repeater_01.png)

Figura 16: Burp Suite: Enviar a repetidor

Una vez en la pestaña _Repetidor_ , haremos clic en _Enviar_ para reenviar nuestra solicitud original (sin modificar). La respuesta establecerá una base de referencia con la que podremos evaluar las solicitudes posteriores, modificadas arbitrariamente, a la misma URL y sus respuestas correspondientes.

![Figura 17: Solicitud de reenvío del repetidor de Burp Suite](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/ba6c00636c7fdcb14cad7c5c896c2183-tm_burp_repeater_02.png)

Figura 17: Solicitud de reenvío del repetidor de Burp Suite

Ahora que tenemos una respuesta de referencia, haremos un pequeño cambio en nuestra solicitud original. Un aspecto interesante de la respuesta de referencia es que incluye varias cabeceras _de control de acceso_ . Estas cabeceras suelen indicar que la aplicación admite [_el intercambio de recursos de origen cruzado_](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing) (CORS). Nuestra solicitud original no incluía una cabecera _de origen_ . Veamos qué sucede si enviamos una. Agregaremos "Origin: hello.world" a la solicitud y luego haremos clic en _Enviar_ .

![Figura 18: Burp Suite envía una solicitud modificada](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/679f7af28e71c75f1315995c48e4fb62-tm_burp_repeater_03.png)

Figura 18: Burp Suite envía una solicitud modificada

En la figura 18, la respuesta tiene un valor _de Access-Control-Allow-Origin_ diferente , que refleja el valor que enviamos. Para comparar mejor las respuestas, podemos usar la función _Comparador_ haciendo clic con el botón derecho en la respuesta y seleccionando _Enviar al comparador_ .

![Figura 19: Burp Suite envía una respuesta al comparador](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/132431bbd1f83b83c4cbcbbbe5a4f769-tm_burp_repeater_04.png)

Figura 19: Burp Suite envía una respuesta al comparador

Antes de cambiar a la pestaña _Comparador_ , volvamos a nuestra solicitud original (Figura 20) y _enviemos al comparador_ para que tengamos dos respuestas diferentes que podamos comparar (Figura 19).

![Figura 20: Solicitud y respuesta anteriores del repetidor de Burp Suite](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/3e4090660326fb1296e39200c6c0c118-tm_burp_repeater_05.png)

Figura 20: Solicitud y respuesta anteriores del repetidor de Burp Suite

![Figura 19: Burp Suite envía una segunda respuesta al comparador.](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/d7ab7aced2eb2d0f3a400c3fdc897db0-tm_burp_repeater_06.png)

Figura 19: Burp Suite envía una segunda respuesta al comparador.

Ahora podemos cambiar a la pestaña _Comparador_ , donde Burp Suite ha resaltado automáticamente las diferentes respuestas en sus respectivas ventanas. En este punto, tenemos la opción de comparar las respuestas para detectar diferencias en _Palabras_ o _Bytes_ . Elegiremos la opción _Palabras_ (Figura 21), ya que este ejemplo no incluye una respuesta binaria.

![Figura 21: Pestaña Comparador de Burp Suite](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/46c523d269268fb5510a9560262e7b1d-tm_burp_comparer_01.png)

Figura 21: Pestaña Comparador de Burp Suite

Burp Suite muestra los resultados de la comparación en una ventana dedicada (Figura 22), resaltando cada cambio con un código de color para _Modificado_ , _Eliminado_ y _Agregado_ .

![Figura 22: Pestaña Comparador de Burp Suite - comparación de palabras](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/4b38e197d8812c8d2537595342e9cc0a-tm_burp_comparer_02.png)

Figura 22: Pestaña Comparador de Burp Suite - comparación de palabras

En este ejemplo, Burp Suite resaltó las diferencias _de Modified_ y _Deleted_ entre las dos respuestas. Anteriormente identificamos el cambio en el valor de _Access-Control-Allow-Origin , pero Comparer también ha resaltado que los encabezados_ _Vary_ y _Access-Control-Allow-Credentials_ están presentes en la primera respuesta, pero no en la segunda.

Aunque este es un ejemplo muy simple, muestra cómo las herramientas _Repeater_ y _Comparer_
pueden ser extremadamente valiosas al probar una aplicación web.

## 1.1.5. Decodificador de Burp Suite

Al analizar aplicaciones web modernas, a menudo encontramos datos codificados en las solicitudes y respuestas HTTP. Afortunadamente, Burp Suite cuenta con una herramienta de decodificación versátil y fácil de integrar en nuestro flujo de trabajo.

Como ejemplo, abramos nuestro navegador e intentemos iniciar sesión en la aplicación Concord con "test" como nombre de usuario y contraseña. Esto devuelve el mensaje "Nombre de usuario o contraseña no válidos". Volvamos a Burp Suite. Curiosamente, nuestro navegador envió una solicitud GET a **/api/service/console/whoami** . Las solicitudes de inicio de sesión suelen ser POST. Hagamos clic en la nueva solicitud.

La nueva solicitud GET incluía una cabecera _de autorización_ con el valor "Basic dGVzdDp0ZXN0". Si seleccionamos el texto "dGVzdDp0ZXN0", la herramienta Inspector detectará que está codificado en base64 y mostrará el texto decodificado en la parte derecha de la ventana de Burp Suite.

![Figura 23: Solicitud de inicio de sesión de Burp Suite](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/fba54ae93c9751bfed3f257057259afe-tm_burp_decoder_01.png)

La herramienta Inspector es útil para decodificar rápidamente los tipos de codificación más comunes en la pestaña del historial HTTP. La herramienta Decoder de Burp Suite es una versión más potente de la herramienta Inspector. Probémosla haciendo clic con el botón derecho en el texto resaltado y seleccionando _Enviar a Decoder_ .

![Figura 24: Función Enviar al decodificador de Burp Suite](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/72f6805bc8509fc457396a3bd549fc6e-tm_burp_decoder_02.png)


Ahora, si cambiamos a la pestaña _Decodificador_ , podemos elegir la opción _Decodificar como_ a la derecha y seleccionar _Base64_ para el esquema de codificación (Figura 25).

![Figura 25: Burp Suite decodificando los valores seleccionados](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/8bf6f080436cbef5a56cd11f90cb9ce9-tm_burp_decoder_03.png)

Como resultado, se abre un segundo cuadro de texto con el valor decodificado debajo de nuestros datos originales.

![Figura 26: Burp Suite decodificó correctamente los valores seleccionados](https://static.offsec.com/offsec-courses/WEB-300/images/tools_&_methodologies/90735a5c3c1fe160da6bea7b339a75ad-tm_burp_decoder_04.png)

El valor decodificado coincide con la salida de la herramienta Inspector, pero la herramienta Decoder permite opciones para codificación, decodificación y hash.

Hasta ahora, solo hemos mostrado algunas funciones básicas, aunque útiles, de Burp Suite. Esta herramienta contiene muchas más funciones que pueden resultar muy útiles al investigar aplicaciones web modernas y complejas.

#### Ceremonias

1. Tómese un tiempo para familiarizarse con el proxy de Burp Suite y sus diversas funcionalidades.
2. Dedica tiempo a aprender más sobre las [funciones básicas de Burp Suite](https://portswigger.net/burp/documentation) , ya que este conocimiento mejorará la eficiencia de tu flujo de trabajo.

## 2.2. Interacción con oyentes web mediante Python
